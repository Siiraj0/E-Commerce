<%- include('../layouts/admin/adminHeaders.ejs') %>

    <body data-layout="horizontal" data-topbar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">

    <!-- header -->

    <%- include('../layouts/admin/pageTopbar.ejs') %>
            <!-- ========== Left Sidebar Start ========== -->
            <%- include('../layouts/admin/verticalMenu.ejs') %>
            <!-- Left Sidebar End -->
            <%- include('../layouts/admin/leftsidebarEnd.ejs') %>
    


            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-flex align-items-center justify-content-between">
                                    <h4 class="mb-0">Orders</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Ecommerce</a></li>
                                            <li class="breadcrumb-item active">Orders</li>
                                        </ol>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-sm-4">
                                                <div class="search-box me-2 mb-2 d-inline-block">
                                                    <div class="position-relative">
                                                        <input type="text" class="form-control" placeholder="Search...">
                                                        <i class="bx bx-search-alt search-icon"></i>
                                                    </div>
                                                </div>
                                            </div>
                                          
                                        </div>
                
                                        <div class="table-responsive">
                                            <table class="table align-middle table-nowrap table-check">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 20px;" class="align-middle">
                                                            <div class="form-check font-size-16">
                                                                <input class="form-check-input" type="checkbox" id="checkAll">
                                                                <label class="form-check-label" for="checkAll"></label>
                                                            </div>
                                                        </th>
                                                        <th>Product Name</th>
                                                        <th>Image</th>
                                                        <th>Price</th>
                                                        <th>Count</th>
                                                        <th>Total Price</th>
                                                        <th>Status</th>
                                                </thead>
                                                <tbody>
                                                    <% orders.products.forEach((e, i) => { %>
                                                        <tr>
                                                            <td><%= i + 1 %></td>
                                                            <td><%= e.productId.name %></td>
                                                            <td>
                                                                <img style="width: 3rem; height: 3rem; border-radius: 50%;" src="<%= e.productId.image[0] %>" alt="" srcset="">
                                                            </td>
                                                            <td><%= e.productId.price %></td>
                                                            <td><%= e.quantity %></td>
                                                            <td><%= orders.orderAmount %></td>
                                                            <td>
                                                                <% if (e.orderStatus === 'Delivered' || e.orderStatus === 'Cancelled') { %>
                                                                    <span><%= e.orderStatus %></span>
                                                                <% } else { %>
                                                                    <select onchange="updateOrderStatus('<%= e._id %>', this.value)">
                                                                        <option value="Pending" <%= e.orderStatus === 'Pending' ? 'selected' : '' %>>Pending</option>
                                                                        <option value="Shipped" <%= e.orderStatus === 'Shipped' ? 'selected' : '' %>>Shipped</option>
                                                                        <option value="Delivered" <%= e.orderStatus === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                                                                        <option value="Cancelled" <%= e.orderStatus === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                                                                    </select>
                                                                <% } %>
                                                            </td>
                                                        </tr>
                                                    <% }); %>
                                                </tbody>
                                                
                                                
                                                
                                            </table>
                                        </div>
                                        <ul class="pagination pagination-rounded justify-content-end mb-2">
                                            <li class="page-item disabled">
                                                <a class="page-link" href="javascript: void(0);" aria-label="Previous">
                                                    <i class="mdi mdi-chevron-left"></i>
                                                </a>
                                            </li>
                                            <li class="page-item active"><a class="page-link" href="javascript: void(0);">1</a></li>
                                            <li class="page-item"><a class="page-link" href="javascript: void(0);">2</a></li>
                                            <li class="page-item"><a class="page-link" href="javascript: void(0);">3</a></li>
                                            <li class="page-item"><a class="page-link" href="javascript: void(0);">4</a></li>
                                            <li class="page-item"><a class="page-link" href="javascript: void(0);">5</a></li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript: void(0);" aria-label="Next">
                                                    <i class="mdi mdi-chevron-right"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end row -->

                    </div> <!-- container-fluid -->
                </div>
                <!-- End Page-content -->

               
                <!-- end modal -->
                
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-6">
                                <script>document.write(new Date().getFullYear())</script> &copy; Symox.
                            </div>
                            <div class="col-sm-6">
                                <div class="text-sm-end d-none d-sm-block">
                                    Crafted with <i class="mdi mdi-heart text-danger"></i> by <a href="https://themesbrand.com/" target="_blank" class="text-reset">Themesbrand</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
            <!-- end main content-->

        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <a href="#" class="right-bar-toggle layout-setting-btn" id="right-bar-toggle">
            <i class="icon-sm mb-2" data-feather="settings"></i>
            <span class="align-middle">Settings</span>
          </a>
        <!-- /Right-bar -->

        
  <%- include('../layouts/admin/rightBar.ejs') %>
        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>

        <!-- JAVASCRIPT -->

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
       
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script>
            async function updateOrderStatus(orderId, newStatus) {
    try {
        console.log('Updating order status:', orderId, newStatus); // Debug the input values

        const response = await axios.post('/admin/updateOrderStatus', {
            orderId: orderId,
            newStatus: newStatus
        });

        console.log('Response data:', response.data); // Debug the response data

        if (response.data.success) {
            // Use SweetAlert for successful update
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Order status updated successfully.',
                confirmButtonText: 'OK'
            }).then(() => {
                location.reload(); // Reload to reflect changes
            });
        } else {
            // Use SweetAlert for failure message
            Swal.fire({
                icon: 'error',
                title: 'Failed!',
                text: 'Failed to update order status: ' + response.data.message,
                confirmButtonText: 'OK'
            });
        }
    } catch (error) {
        console.error('Error:', error);
        // Use SweetAlert for error handling
        Swal.fire({
            icon: 'error',
            title: 'Error!',
            text: 'An error occurred while updating the order status.',
            confirmButtonText: 'OK'
        });
    }
}

        </script>

        <base href="/admin/">
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenujs/metismenujs.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/feather-icons/feather.min.js"></script>

        <script src="assets/js/app.js"></script>

    </body>

<!-- Mirrored from themesdesign.in/symox-laravel/layouts/ecommerce-orders.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 23 Feb 2024 16:07:02 GMT -->
</html>

