<%- include('../layouts/user/userHeader.ejs') %>

<body>

    <div class="main-wrapper">
        <header class="header-area section-padding-1">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <!-- Left side with Home and Shop -->
                    <div class="col-xl-4 col-lg-4 d-flex justify-content-start">
                        <div class="main-menu menu-lh-1 main-menu-padding-1">
                            <nav>
                                <ul class="d-flex">
                                    <li><a href="/">Home</a></li>
                                    <li><a href="/shop">Shop</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
        
                    <!-- Centered Logo -->
                    <div class="col-xl-4 col-lg-4 d-flex justify-content-center">
                        <div class="logo logo-width">
                            <a href="/">
                                <img src="user/assets/images/logo/logo.png" alt="logo">
                            </a>
                        </div>
                    </div>
        
                    <!-- Right side with Wishlist, Cart, Search, and Account -->
                    <div class="col-xl-4 col-lg-4 d-flex justify-content-end">
                        <div class="header-right-wrap header-right-flex">
                            <div class="same-style header-wishlist">
                                <a href="wishlist.html"><i class="far fa-heart"></i></a>
                            </div>
                            <div class="same-style cart-wrap">
                                <a href="#" class="cart-active">
                                    <i class="dlicon shopping_bag-20"></i>
                                    <span class="count-style">02</span>
                                </a>
                            </div>
                            <div class="same-style header-search">
                                <a class="search-active" href="#"><i class="dlicon ui-1_zoom"></i></a>
                            </div>
                            <div class="same-style header-off-canvas">
                                <a href="/login">
                                    <i class="far fa-user" style="font-size: 20px; color: black;" onmouseover="this.style.color='red'" onmouseout="this.style.color='black'"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="header-small-mobile section-padding-1">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-6">
                        <div class="mobile-logo logo-width">
                            <a href="index.html">
                                <img alt="" src="user/assets/images/logo/logo.png">
                            </a>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="mobile-header-right-wrap">
                            <div class="header-right-wrap header-right-flex">
                                <div class="same-style cart-wrap">
                                    <a href="#" class="cart-active">
                                        <i class="dlicon shopping_bag-20"></i>
                                        <span class="count-style">02</span>
                                    </a>
                                </div>
                                <div class="same-style header-off-canvas">
                                    <a class="header-aside-button" href="#">
                                        <i class="dlicon ui-3_menu-left"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- search start -->
        <div class="search-content-wrap main-search-active">
            <a class="search-close"><i class="dlicon ui-1_simple-remove"></i></a>
            <div class="search-content">
                <p>Start typing and press Enter to search</p>
                <form class="search-form" >
                    <input type="text" placeholder="Search">
                    <button class="button-search"><i class="dlicon ui-1_zoom"></i></button>
                </form>
            </div>
        </div>
        <!-- mini cart start -->
        <div class="sidebar-cart-active">
            <div class="sidebar-cart-all">
                <a class="cart-close" href="#"><i class="dlicon ui-1_simple-remove"></i></a>
                <div class="cart-content">
                    <h3>Shopping Cart</h3>
                    <ul>
                        <li class="single-product-cart">
                            <div class="cart-img">
                                <a href="#"><img src="user/assets/images/cart/cart-1.jpg" alt=""></a>
                            </div>
                            <div class="cart-title">
                                <h4><a href="#">Bejewelled velvet sandals</a></h4>
                                <span> 1 × $49.00	</span>
                            </div>
                            <div class="cart-delete">
                                <a href="#">×</a>
                            </div>
                        </li>
                        <li class="single-product-cart">
                            <div class="cart-img">
                                <a href="#"><img src="user/assets/images/cart/cart-2.jpg" alt=""></a>
                            </div>
                            <div class="cart-title">
                                <h4><a href="#">Contrast faux fur jacket</a></h4>
                                <span> 1 × $49.00	</span>
                            </div>
                            <div class="cart-delete">
                                <a href="#">×</a>
                            </div>
                        </li>
                    </ul>
                    <div class="cart-total">
                        <h4>Subtotal: <span>$170.00</span></h4>
                    </div>
                    <div class="cart-checkout-btn">
                        <a class="btn-hover cart-btn-style" href="/cart">view cart</a>
                        <a class="no-mrg btn-hover cart-btn-style" href="/checkout">checkout</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- aside start -->
        <div class="header-aside-active">
            <div class="header-aside-wrap">
                <a class="aside-close"><i class="dlicon ui-1_simple-remove"></i></a>
                <div class="header-aside-content">
                    <div class="mobile-menu-area">
                        <div class="mobile-search">
                            <form class="search-form" action="#">
                                <input type="text" placeholder="Search entire store…">
                                <button class="button-search"><i class="dlicon ui-1_zoom"></i></button>
                            </form>
                        </div>
                        <div class="mobile-menu-wrap">
                            <!-- mobile menu start -->
                            <div class="mobile-navigation">
                                <!-- mobile menu navigation start -->
                                <nav>
                                    <ul class="mobile-menu">
                                        <li class="menu-item-has-children"><a href="/">Home</a>
                                            <ul class="dropdown">
                                                <li class="menu-item-has-children"><a href="#">Demo Group 01</a>
                                                    <ul class="dropdown">
                                                        <li><a href="index.html">Home 01</a></li>
                                                        <li><a href="index-2.html">Home 02</a></li>
                                                        <li><a href="index-3.html">Home 03</a></li>
                                                        <li><a href="index-4.html">Home 04</a></li>
                                                        <li><a href="index-5.html">Home 05</a></li>
                                                        <li><a href="index-6.html">Home 06</a></li>
                                                    </ul>
                                                </li>
                                                <li class="menu-item-has-children"><a href="#">Demo Group 02</a>
                                                    <ul class="dropdown">
                                                        <li><a href="index-7.html">Home 07</a></li>
                                                        <li><a href="index-8.html">Home 08</a></li>
                                                        <li><a href="index-9.html">Home 09</a></li>
                                                        <li><a href="index-10.html">Home 10</a></li>
                                                        <li><a href="index-11.html">Home 11</a></li>
                                                        <li><a href="index-12.html">Home 12</a></li>
                                                    </ul>
                                                </li>
                                                <li class="menu-item-has-children"><a href="#">Demo Group 03</a>
                                                    <ul class="dropdown">
                                                        <li><a href="index-13.html">Home 13</a></li>
                                                        <li><a href="index-14.html">Home 14</a></li>
                                                        <li><a href="index-15.html">Home 15</a></li>
                                                        <li><a href="index-16.html">Home 16</a></li>
                                                        <li><a href="index-17.html">Home 17</a></li>
                                                        <li><a href="index-18.html">Home 18</a></li>
                                                        <li><a href="index-19.html">Home 19</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="menu-item-has-children"><a href="#">Pages</a>
                                            <ul class="dropdown">
                                                <li><a href="about-us.html">About Us</a></li>
                                                <li><a href="contact-us.html">Contact Page</a></li>
                                                <li><a href="404.html">404 Page</a></li>
                                                <li><a href="comming-soon.html">Comming Soon 01</a></li>
                                                <li><a href="comming-soon-2.html">Comming Soon 02</a></li>
                                                <li><a href="faq.html">FAQ</a></li>
                                            </ul>
                                        </li>
                                        <li class="menu-item-has-children "><a href="shop-fullwide.html">shop</a>
                                            <ul class="dropdown">
                                                <li class="menu-item-has-children"><a href="#">Shop Layout</a>
                                                    <ul class="dropdown">
                                                        <li><a href="shop-fullwide.html">Shop Fullwidth</a></li>
                                                        <li><a href="shop-sidebar.html">Shop Sidebar</a></li>
                                                        <li><a href="shop-metro.html">Shop Metro Layout</a></li>
                                                        <li><a href="shop-3-col.html">Shop 03 Columns</a></li>
                                                        <li><a href="shop-2-col.html">Shop 02 Columns</a></li>
                                                        <li><a href="shop-collection-1.html">Shop Collection 01</a></li>
                                                        <li><a href="shop-collection-2.html">Shop Collection 02</a></li>
                                                    </ul>
                                                </li>
                                                <li class="menu-item-has-children"><a href="#">Product Layout</a>
                                                    <ul class="dropdown">
                                                        <li><a href="product-details.html">Single 01</a></li>
                                                        <li><a href="product-details-2.html">Single 02</a></li>
                                                        <li><a href="product-details-group.html">Grouped</a></li>
                                                        <li><a href="product-details-sticky.html">Sticky Info</a></li>
                                                        <li><a href="product-details-configurable.html">Configurable</a></li>
                                                        <li><a href="product-details-thumbnail.html">Thumbnail</a></li>
                                                        <li><a href="product-details-video.html">Video</a></li>
                                                        <li><a href="product-details-affiliate.html">Affiliate</a></li>
                                                        <li><a href="product-details-sidebar.html">Sidebar</a></li>
                                                    </ul>
                                                </li>
                                                <li class="menu-item-has-children"><a href="#">Shop Pages </a>
                                                    <ul class="dropdown">
                                                        <li><a href="my-account.html">My Account</a></li>
                                                        <li><a href="checkout.html">Check Out</a></li>
                                                        <li><a href="cart.html">Shopping Cart</a></li>
                                                        <li><a href="wishlist.html">Wishlist</a></li>
                                                        <li><a href="order-tracking.html">Order Tracking</a></li>
                                                        <li><a href="compare.html">Compare</a></li>
                                                        <li><a href="login-register.html">login / register</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="menu-item-has-children "><a href="shop-collection-1.html">Collection</a>
                                            <ul class="dropdown">
                                                <li><a href="shop-collection-1.html">Shop Collection 01</a></li>
                                                <li><a href="shop-collection-2.html">Shop Collection 02</a></li>
                                                <li><a href="shop-metro.html">Shop Metro Layout</a></li>
                                            </ul>
                                        </li>
                                        <li class="menu-item-has-children "><a href="blog.html">Blog</a>
                                            <ul class="dropdown">
                                                <li><a href="blog.html">Blog Style 01</a></li>
                                                <li><a href="blog-2.html">Blog Style 02</a></li>
                                                <li><a href="blog-3.html">Blog Style 03</a></li>
                                                <li><a href="blog-details.html">Single Post Style 01</a></li>
                                                <li><a href="blog-details-2.html">Single Post Style 02</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="shop-instagram.html">Instagram Shop </a></li>
                                    </ul>
                                </nav>
                                <!-- mobile menu navigation end -->
                            </div>
                            <!-- mobile menu end -->
                        </div>
                        <div class="mobile-curr-lang-wrap">
                            <div class="single-mobile-curr-lang">
                                <a class="mobile-language-active" href="#">Language <i class="fa fa-angle-down"></i></a>
                                <div class="lang-curr-dropdown lang-dropdown-active">
                                    <ul>
                                        <li><a href="#">English (US)</a></li>
                                        <li><a href="#">English (UK)</a></li>
                                        <li><a href="#">Spanish</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="single-mobile-curr-lang">
                                <a class="mobile-currency-active" href="#">Currency <i class="fa fa-angle-down"></i></a>
                                <div class="lang-curr-dropdown curr-dropdown-active">
                                    <ul>
                                        <li><a href="#">USD</a></li>
                                        <li><a href="#">EUR</a></li>
                                        <li><a href="#">Real</a></li>
                                        <li><a href="#">BDT</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="single-mobile-curr-lang">
                                <a class="mobile-account-active" href="#">My Account <i class="fa fa-angle-down"></i></a>
                                <div class="lang-curr-dropdown account-dropdown-active">
                                    <ul>
                                        <li><a href="#">Login</a></li>
                                        <li><a href="#">Creat Account</a></li>
                                        <li><a href="my-account.html">My Account</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-aside-menu">
                        <nav>
                            <ul>
                                <li><a href="#">About Toro</a></li>
                                <li><a href="#">Help Center</a></li>
                                <li><a href="#">Collection</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">New Look</a></li>
                            </ul>
                        </nav>
                    </div>
                    <img src="user/assets/images/icon-img/payments.png" alt="payment">
                    <p>Pellentesque mollis nec orci id tincidunt. Sed mollis risus eu nisi aliquet, sit amet fermentum justo dapibus.</p>
                    <div class="aside-contact-info">
                        <ul>
                            <li><i class="dlicon ui-2_time-clock"></i>Monday - Friday: 9:00 - 19:00</li>
                            <li><i class="dlicon ui-1_email-84"></i>Info@la-studioweb.com</li>
                            <li><i class="dlicon tech-2_rotate"></i>(+55) 254. 254. 254</li>
                            <li><i class="dlicon ui-1_home-minimal"></i>Helios Tower 75 Tam Trinh Hoang - Ha Noi - Viet Nam</li>
                        </ul>
                    </div>
                    <div class="social-icon-style mb-25">
                        <a class="facebook" href="#"><i class="fa fa-facebook"></i></a>
                        <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
                        <a class="google-plus" href="#"><i class="fa fa-google-plus"></i></a>
                        <a class="behance" href="#"><i class="fa fa-behance"></i></a>
                    </div>
                    <div class="copyright">
                        <p>© 2021 <a href="https://hasthemes.com/">Toro.</a> All rights reserved</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="breadcrumb-area section-padding-1 bg-gray breadcrumb-ptb-1">
            <div class="container-fluid">
                <div class="breadcrumb-content text-center">
                    <div class="breadcrumb-title">
                        <h2>Checkout</h2>
                    </div>
                    <ul>
                        <li>
                            <a href="/">Home </a>
                        </li>
                        <li><span> &gt; </span></li>
                        <li class="active">Checkout </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- checkout start -->
        <div class="checkout-main-area pt-100 pb-100">
            <div class="container">
                <div class="customer-zone mb-30">
                    <p class="cart-page-title">Have a coupon? <a class="checkout-click" href="#">Click here to enter your code</a></p>
                    <div class="checkout-login-info">
                        <p>If you have a coupon code, please apply it below.</p>
                        <div id="couponForm" class="coupon-form">
                            <div class="coupon-input-container">
                                <input type="text" id="couponCode" placeholder="Coupon code" class="coupon-input">
                                <button type="button" id="applyCouponBtn" onclick="applyCoupon()" class="coupon-btn">Apply Coupon</button>
                                <button type="button" id="removeCouponBtn" onclick="removeCoupon()" class="coupon-btn" style="display: none;">Remove Coupon</button>
                            </div>
                            <button type="button" id="showCoupons" onclick="showCoupons()" class="coupon-btn coupon-show">Show Coupons</button>
                        </div>
                        
                        
                    </div>
                </div>
                
                
                
                
                <div class="checkout-wrap">
                    <div class="row">
                        <div class="col-lg-7" >
                            <div class="your-order-area" id="shippingArea">
                                <h3>SHIPPING ADDRESS</h3>
                                <!-- <% console.log(locals.addresses._id,'addres.-id'); %> -->
                                <% if(locals.addresses?.length >= 1) { %>
                                    <h6 class="text-secondary fw-semibold ">DEFAULT ADDRESS</h6>
                                    <form action="/placeOrder" method="post" id="myForm">
                                        <input hidden type="text" id="payment" name="paymentMethod" value="">
                                        <input hidden type="text" id="totalprice" name="orderAmount" value="">
                                        <input hidden type="text" id="couponDiscountInput" name="couponDiscount" value="">
                                        <% locals.addresses.forEach((address, index) => { %>
                                            <div class="checkout-addressDiv mb-2">
                                                <div style="display: flex; flex-direction: row-reverse;">
                                                    <div class="">
                                                        <input type="radio" class="paymntRadioBox" name="addressSelected" id='addresId<%= index %>' value="<%= address._id %>">
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <h5 class="fw-semibold"><%= address.name %></h5>
                                                    <p>
                                                        <%= address.streetAddress %>, <%= address.locality %><br>
                                                        <%= address.city %>, <%= address.state %> - <%= address.pincode %><br>
                                                        Mobile : <span class="fw-semibold "><%= address.mobile %></span><br>
                                                    </p>
                                                    <div class="">
                                                        <button class="btn btn-light checkout-editAdd-btn" data-bs-toggle="modal" data-bs-target="#editAddressModal" onclick="editAddress('<%= address._id %>')">Edit</button>
                                                        <button class="btn btn-light checkout-editAdd-btn" onclick="removeAddress('<%= address._id %>')">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </form>
                                    
                                  
                                    
                                    
                                    
                                    
                                <% } %>
                                <div class="checkout-addNew-Add">
                                    <div class="text-center ">
                                        <a class="text-danger" data-bs-target="#addAddressModal" data-bs-toggle="modal"><span>+ </span>Add New Address</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <div class="your-order-area">
                                <h3>Your order</h3>
                
                                
                
                                <div class="your-order-wrap gray-bg-4">
                                    <div class="your-order-info-wrap">
                                        <div class="your-order-info">
                                            <ul>
                                                <li>Product <span>Total</span></li>
                                            </ul>
                                        </div>
                                        <% cartdata[0]?.products.forEach((product) => { %>
                                            <% console.log(product); %>
                               
                                        <div class="your-order-middle">
                                            
                                            <ul>
                                                <li class="product-total">
                                                    <%= product.productId.name %> x <%= product.count %> 
                                                    <span>
                                                        ₹<%= product.productId.offer ? 
                                                             Math.floor(product.productId.offerPrice * product.count) :
                                                             Math.floor(product.productId.price * product.count) %>
                                                    </span>
                                                </li>
                                            </ul>
                                            
                                        </div>
                                        <%  }); %>
                                        <div class="your-order-info order-subtotal">
                                            <ul>
                                                <li>Subtotal <span id="product-subtotal">₹0.00</span></li>
                                            </ul>
                                        </div>
                                        <div class="your-order-info coupon-discount">
                                            <ul>
                                                <li>Coupon Discount <span id="couponDiscount">₹0.00</span></li>
                                            </ul>
                                        </div>
                                        <div class="your-order-info order-total">
                                            <ul>
                                                <li>Total <span id="product-total">₹0.00</span></li>
                                            </ul>
                                        </div>
                                        
                                        <input type="hidden" id="totalprice" value="0.00">
                                    </div>
                                    <div class="payment-method">
                                      
                                      
                
                                      </div>
                                      <div class="billing-select mb-10">
                                        <label>Payment method </label>
                                        <select id="paymentMethod" class="select-active ">
                                            <option value="COD">Cash on Delivery</option>
                                            <option value="Online Payment">Rozar Pay</option>
                                           
                                        </select>
                                    </div>
                                </div>
                                <div class="Place-order mt-30">
                                    <a  onclick="placeorder()">Place Order</a>
                                  
                                </div>
                            </div>
                        </div>
            </div>
        </div>
                        
                    
            </div>
        </div>
        <!-- checkout end -->

  <!-- Add Address Modal -->
        <div class="modal" id="addAddressModal" tabindex="-1">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h4 class="modal-title">New Address</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name :</label>
                                <input type="text" class="form-control" id="nameId"
                                    name="name" placeholder="Enter Name">
                                    <p id="nameError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="mobile" class="form-label">Mobile :</label>
                                <input type="number" class="form-control" id="mobileId"
                                    name="mobile" placeholder="Enter Mobile number">
                                    <p id="mobileError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="pincode" class="form-label">Pincode :</label>
                                <input type="number" class="form-control" id="pincodeId"
                                    name="pincode" placeholder="Enter Pincode">
                                    <p id="pincodeError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="state" class="form-label">State :</label>
                                <input type="text" class="form-control" id="stateId"
                                    name="state" placeholder="Enter State">
                                    <p id="stateError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="street" class="form-label">Address :</label>
                                <input type="text" class="form-control" id="streetId"
                                    name="streetAddress" placeholder="eg. House No, Street, Area">
                                    <p id="streetError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="locality" class="form-label">Locality/ Town :</label>
                                <input type="text" class="form-control" id="localityId"
                                    name="locality" placeholder="Enter Locality">
                                    <p id="localityError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="city" class="form-label">City/ District :</label>
                                <input type="text" class="form-control" id="cityId"
                                    name="city" placeholder="Enter City">
                                    <p id="cityError" class="text-danger "></p>
                            </div>
                            <p id="adEmptyError" class="text-danger"></p>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="closeAdd" data-bs-dismiss="modal">Close</button>
                <button type="submit" onclick="addNewAddress()" class="btn btn-primary">Save changes</button>
                </div>
            </div>
            </div>
        </div>
        <!-- Add Address Modal End -->


                <!-- Edit Address Modal -->

         <div class="modal" id="editAddressModal" tabindex="-1">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Edit Address</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    
                            <div class="mb-3">
                                <p id="addresId" hidden></p>
                                <label for="name" class="form-label">Name :</label>
                                <input type="text" class="form-control" id="editAdNameId"
                                    name="editName">
                                <p id="editNameError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="mobile" class="form-label">Mobile :</label>
                                <input type="number" class="form-control" id="editMobileId"
                                    name="editMobile" >
                                    <p id="editMobileError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="pincode" class="form-label">Pincode :</label>
                                <input type="number" class="form-control" id="editPincodeId"
                                    name="editPincode" >
                                    <p id="editPincodeError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="state" class="form-label">State :</label>
                                <input type="text" class="form-control" id="editStateId"
                                    name="editState" >
                                    <p id="editStateError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="street" class="form-label">Address :</label>
                                <input type="text" class="form-control" id="editStreetId"
                                    name="editStreetAddress" >
                                    <p id="editStreetAddressError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="locality" class="form-label">Locality/ Town :</label>
                                <input type="text" class="form-control" id="editLocalityId"
                                    name="editLocality" >
                                    <p id="editLocalityError" class="text-danger "></p>
                            </div>
                            <div class="mb-3">
                                <label for="city" class="form-label">City/ District :</label>
                                <input type="text" class="form-control" id="editCityId"
                                    name="editCity" >
                                    <p id="editCityError" class="text-danger "></p>
                            </div>
                            <p id="editEmptyError" class="text-danger"></p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" id="closeEdit" data-bs-dismiss="modal">Close</button>
                  <button type="submit"  class="btn btn-primary" onclick="saveEditAddress()" id="saveEditAddressId">Save changes</button>
                </div>
             
              </div>
            </div>
        </div>
        <!-- Edit Address Modal End -->



        <footer class="footer-area section-padding-1 border-top-3">
            <div class="container-fluid">
                <div class="footer-top pt-100 pb-60">
                    <div class="row">
                        <div class="footer-column footer-width-24">
                            <div class="footer-widget footer-about mb-30">
                                <a href="index.html">
                                    <img src="user/assets/images/logo/logo.png" alt="logo">
                                </a>
                                <p>Lorem ipsum dolor sit amet, magna habemus ius ad, qui minimum voluptar</p>
                                <div class="social-icon-style-2 social-icon-hm4">
                                    <a class="facebook" href="#"><i class="fa fa-facebook"></i></a>
                                    <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
                                    <a class="youtube" href="#"><i class="fa fa-youtube"></i></a>
                                    <a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="footer-column footer-width-12">
                            <div class="footer-widget footer-info-list-2 mb-30">
                                <h3 class="footer-title">Company Link</h3>
                                <ul>
                                    <li><a href="#">About Us</a></li>
                                    <li><a href="#">Help Center</a></li>
                                    <li><a href="#">Our Team</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">The Blog</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="footer-column footer-width-14">
                            <div class="footer-widget footer-info-list-2 mb-30">
                                <h3 class="footer-title">Userful Link</h3>
                                <ul>
                                    <li><a href="#">Guides & Articles</a></li>
                                    <li><a href="#">Customer Reviews</a></li>
                                    <li><a href="#">Coupon Codes</a></li>
                                    <li><a href="#">Military Discount</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="footer-column footer-width-19">
                            <div class="footer-widget footer-info-list-2 footer-contect mb-30">
                                <h3 class="footer-title">Contact info</h3>
                                <ul>
                                    <li><i class="dlicon ui-2_time-clock"></i> Monday - Friday: 9:00 - 19:00</li>
                                    <li><i class="dlicon ui-1_email-83"></i> info@example.com</li>
                                    <li><i class="dlicon tech-2_rotate"></i> (+612) 2531 5600</li>
                                    <li><i class="dlicon ui-1_home-simple"></i> PO Box 1622 Colins Street West Victoria 8077 Australia</li>
                                </ul>
                            </div>
                        </div>
                        <div class="footer-column footer-width-29 mb-30">
                            <div class="contact-page-map">
                                <div id="contact-map">
                                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3151.838709675939!2d144.95320007668528!3d-37.817246734238516!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6ad65d4dd5a05d97%3A0x3e64f855a564844d!2s121%20King%20St%2C%20Melbourne%20VIC%203000%2C%20Australia!5e0!3m2!1sen!2sus!4v1670477011653!5m2!1sen!2sus" style="border:0;width:100%;height:100%;" allowfullscreen="" loading="lazy"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-botoom">
                    <div class="row">
                        <div class="col-12">
                            <div class="copyright-2 text-center">
                                <p>© 2021 <a href="https://hasthemes.com/">Toro.</a> All rights reserved.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <div class="support-lists">
            <ul>
                <li><a href="#"><i class="dlicon ui-3_chat-46"></i></a></li>
                <li><a href="#"><i class=" dlicon ui-3_phone"></i></a></li>
                <li><a href="#"><i class="dlicon ui-1_email-85"></i></a></li>
            </ul>
        </div>
    
    </div>


            <!-- SweetAlert2 CSS -->

    <style>
        /* Container styles */
.coupon-form {
    display: flex;
    flex-direction: column; /* Stack elements vertically */
    gap: 10px; /* Space between elements */
}

/* Container for input and buttons in the same line */
.coupon-input-container {
    width: 80%;
    display: flex;
    align-items: center; /* Align items vertically */
    gap: 10px; /* Space between input and buttons */
}

/* Input styles */
.coupon-input {
    flex: 1; /* Allow input to expand and fill available space */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
}

/* Button styles */
.coupon-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    background-color: #007bff; /* Example button color */
    color: white;
    transition: background-color 0.3s;
}

.coupon-btn:hover {
    background-color: #0056b3; /* Darker color on hover */
}

/* Show Coupons button styles */
.coupon-show {
    background-color: black; /* Custom color for "Show Coupons" button */
}

.coupon-show:hover {
    background-color: #333; /* Darker color on hover */
}

    </style>
            

            <style>
                .swal2-popup {
                    width: 80% !important;
                    max-width: none !important;
                }
                .swal2-html-container {
                    max-height: 400px;
                    overflow-y: auto;
                    width: 100%;
                }
                .swal2-html-container table {
                    width: 100%;
                    border-collapse: collapse;
                }
                .swal2-html-container th, .swal2-html-container td {
                    border: 1px solid #ddd;
                    padding: 8px;
                }
                .swal2-html-container th {
                    background-color: #f2f2f2;
                    text-align: left;
                }
                .copy-btn {
                    margin-left: 10px;
                    cursor: pointer;
                }
                .copy-btn img {
                    width: 20px;
                    height: 20px;
                }
            </style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- All JS is here
============================================ -->

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>






<script>
 
       async function addNewAddress(){
        
            const name = document.getElementById('nameId').value.trim()
            
            const mobile = document.getElementById('mobileId').value.trim()
            const pincode = document.getElementById('pincodeId').value.trim()
            const state = document.getElementById('stateId').value.trim()
            const streetAddress = document.getElementById('streetId').value.trim()
            const locality = document.getElementById('localityId').value.trim()
            const city = document.getElementById('cityId').value.trim()

            document.getElementById('nameError').innerHTML = '';
            document.getElementById('mobileError').innerHTML = '';
            document.getElementById('pincodeError').innerHTML = '';
            document.getElementById('stateError').innerHTML = '';
            document.getElementById('streetError').innerHTML = '';
            document.getElementById('localityError').innerHTML = '';
            document.getElementById('cityError').innerHTML = '';

            if(name === '' && mobile === '' && pincode === '' && state === '' && streetAddress === '' && locality === '' && city === ''){
                document.getElementById('adEmptyError').innerHTML = 'Please fill all the fields';
                return false
            } 

            if(name === '' || /\d/.test(name) || /[^\w\s]/.test(name)){
                document.getElementById('nameError').innerHTML = 'Please enter a name';
                return false
            } 

            if (mobile === '') {
                document.getElementById("mobileError").innerHTML = 'Please enter your Mobile Number';
                return false;
            } else if(mobile.length < 10){
                document.getElementById("mobileError").innerHTML = 'Phone must be at least 10 numbers';
                return false
            }

            if (pincode === '') {
                document.getElementById("pincodeError").innerHTML = 'Please enter your Pincode';
                return false;
            }

            if (state === '') {
                document.getElementById("stateError").innerHTML = 'Please enter your state';
                return false;
            }

            if (streetAddress === '') {
                document.getElementById("streetError").innerHTML = 'Please enter your street Address';
                return false;
            }

            if (locality === '') {
                document.getElementById("localityError").innerHTML = 'Please enter your locality';
                return false;
            }

            if (city === '') {
                document.getElementById("cityError").innerHTML = 'Please enter your city';
                return false;
            }

            const response = await axios.patch('/checkoutAddAddress',{name, mobile, pincode, state, streetAddress, locality, city})

            if(response.data.loginRequired){
                window.location.href = '/login'
            }else{
                if(response.data.success){
                    const closeBtn = document.getElementById('closeAdd')
                    closeBtn.click()
                    $('#shippingArea').load('/checkout #shippingArea')
                }
            }            
        }


        

        async function editAddress(addressId) {
            try{
                document.getElementById('addresId').dataset.addresId=addressId
                const name = document.getElementById('editAdNameId')
                const mobile = document.getElementById('editMobileId')
                const pincode = document.getElementById('editPincodeId')
                const state = document.getElementById('editStateId')
                const streetAddress = document.getElementById('editStreetId')
                const locality = document.getElementById('editLocalityId')
                const city = document.getElementById('editCityId')

                const response = await axios.post('/loadEditAddress',{addressId})
                const data = response.data
                console.log(data);
                if(data){
                    name.value = response.data.findAddress.name
                    mobile.value = response.data.findAddress.mobile
                    pincode.value = response.data.findAddress.pincode
                    state.value = response.data.findAddress.state
                    streetAddress.value = response.data.findAddress.streetAddress
                    locality.value = response.data.findAddress.locality
                    city.value = response.data.findAddress.city
                }
            }catch(error){
                console.log(error.message);
            }
        }


         async function saveEditAddress() {
            const addressId=document.getElementById('addresId').dataset.addresId
            const name = document.getElementById('editAdNameId').value.trim()
            const mobile = document.getElementById('editMobileId').value.trim()
            const pincode = document.getElementById('editPincodeId').value.trim()
            const state = document.getElementById('editStateId').value.trim()
            const streetAddress = document.getElementById('editStreetId').value.trim()
            const locality = document.getElementById('editLocalityId').value.trim()
            const city = document.getElementById('editCityId').value.trim()

            document.getElementById('editNameError').innerHTML = '';
            document.getElementById('editMobileError').innerHTML = '';
            document.getElementById('editPincodeError').innerHTML = '';
            document.getElementById('editStateError').innerHTML = '';
            document.getElementById('editStreetAddressError').innerHTML = '';
            document.getElementById('editLocalityError').innerHTML = '';
            document.getElementById('editCityError').innerHTML = '';

            if(name === '' && mobile === '' && pincode === '' && state === '' && streetAddress === '' && locality === '' && city === ''){
                document.getElementById('editEmptyError').innerHTML = 'Please fill all the fields';
                return false
            } 

            if(name === '' || /\d/.test(name) || /[^\w\s]/.test(name)){
                document.getElementById('editNameError').innerHTML = 'Please enter a name';
                return false
            } 

            if (mobile === '') {
                document.getElementById("editMobileError").innerHTML = 'Please enter your Mobile Number';
                return false;
            } else if(mobile.length < 10){
                document.getElementById("editMobileError").innerHTML = 'Phone must be at least 10 numbers';
                return false
            }

            if (pincode === '') {
                document.getElementById("editPincodeError").innerHTML = 'Please enter your Pincode';
                return false;
            }

            if (state === '') {
                document.getElementById("editStateError").innerHTML = 'Please enter your state';
                return false;
            }

            if (streetAddress === '') {
                document.getElementById("editStreetAddressError").innerHTML = 'Please enter your street Address';
                return false;
            }

            if (locality === '') {
                document.getElementById("editLocalityError").innerHTML = 'Please enter your locality';
                return false;
            }

            if (city === '') {
                document.getElementById("editCityError").innerHTML = 'Please enter your city';
                return false;
            }

            const result = await Swal.fire({
                title: "Are you sure?",
                text: "Make changes in this address",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Confirm"
            })

            if(result.isConfirmed){
                try{
            
                    const response = await axios.patch('/saveEditAddress', { addressId, name: name, mobile: mobile, pincode: pincode,
                    state: state, streetAddress: streetAddress, locality: locality,city: city});
                        
                    if(response.data.loginRequired){
                        window.location.href = '/login'
                    }else{
                        if (response.data.success) {
                            const closeEdit = document.getElementById('closeEdit')
                            closeEdit.click()
                            Swal.fire({
                                position: "center",
                                icon: "success",
                                title: "Address Edited!",
                                showConfirmButton: false,
                                timer: 1500
                            }).then((result)=>{
                                $('#shippingArea').load('/checkout #shippingArea');
                            })
                        }
                    }
                }catch(error){
                    console.log(error.message);
                }
            }
        }

        async function removeAddress(addressId) {
            const result = await Swal.fire({
                title: "Are you sure?",
                text: "Remove this Address",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Delete"
            })
            if(result.isConfirmed){
                try{
                    const response = await axios.patch('/removeAddress',{addressId})

                    if(response.data.loginRequired){
                        window.location.href = '/login'
                    }else{
                        if(response.data.success){
                            $('#shippingArea').load('/checkout #shippingArea');
                        }
                    }

                }catch(error){
                    console.log(error.message);
                }
            }
        }


</script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>



<script>
    document.addEventListener('DOMContentLoaded', () => {
    const total = localStorage.getItem('cartTotal');
    if (total) {
        document.getElementById('checkout-total').textContent = '₹' + total;
    }
});
</script>
<script>
    function calculateTotal() {
        var subtotal = 0;



        const orderAmount= document.getElementById('totalprice')
        // Iterate over each product in your list
        var productElements = document.querySelectorAll('.product-total');
        productElements.forEach(function(productElement) {
            // Extract the price from the span inside the list item
            var priceStr = productElement.querySelector('span').innerText;
            var price = parseFloat(priceStr.replace('₹', ''));

            // Add to subtotal
            subtotal += price;

        });

        orderAmount.value = subtotal.toFixed(2) 
        // Update subtotal display
        var subtotalElement = document.getElementById('product-subtotal');
        if (subtotalElement) {
            subtotalElement.innerText = '₹' + subtotal.toFixed(2);
        }

        // Initially apply discount as 0
        applyDiscount(0);
    }

    function applyDiscount(discountPercentage) {
        const subtotalElement = document.getElementById('product-subtotal');
        const subtotal = parseFloat(subtotalElement.innerText.replace('₹', ''));
        const discountAmount = (subtotal * discountPercentage) / 100;
        const total = subtotal - discountAmount;

        const totalElement = document.getElementById('product-total');
        if (totalElement) {
            totalElement.innerText = '₹' + total.toFixed(2);
        }

        const couponDiscountElement = document.getElementById('couponDiscount');
        if (couponDiscountElement) {
            couponDiscountElement.innerText = '₹' + discountAmount.toFixed(2);
        }

        const totalpriceElement = document.getElementById('totalprice');
        if (totalpriceElement) {
            totalpriceElement.value = Math.round(total); // Round to nearest integer
        }

        const couponDiscountInput = document.getElementById('couponDiscountInput');
        if (couponDiscountInput) {
            couponDiscountInput.value = discountAmount.toFixed(2);
        }
    }

    async function applyCoupon() {
    const couponCode = document.getElementById('couponCode').value.trim();
    
    if (couponCode === '') {
        alert('Please enter a valid coupon code.');
        return;
    }

    console.log('Applying coupon:', couponCode);

    try {
        const response = await axios.post('/couponSubmit', { couponCode });
        const discountPercentage = response.data;
        console.log('Coupon response:', discountPercentage);

        // Apply the discount
        if (discountPercentage) {
            applyDiscount(discountPercentage);
            document.getElementById('applyCouponBtn').style.display = 'none';
            document.getElementById('showCoupons').style.display = 'none';
            document.getElementById('removeCouponBtn').style.display = 'inline-block';
        } else {
            console.error('Invalid discount percentage');
            applyDiscount(0);
        }
    } catch (error) {
        console.error('Error applying coupon:', error);
        applyDiscount(0);
    }
}

function removeCoupon() {
    document.getElementById('couponCode').value = '';
    applyDiscount(0);
    document.getElementById('applyCouponBtn').style.display = 'inline-block';
    document.getElementById('showCoupons').style.display = 'inline-block';
    document.getElementById('removeCouponBtn').style.display = 'none';
}


    async function showCoupons() {
        const totalPriceElement = document.getElementById('product-total');
        const totalAmount = totalPriceElement ? totalPriceElement.innerText.replace('₹', '') : '0';

        try {
            const response = await axios.post('/couponFetch', { money: totalAmount });
            const coupons = response.data;
            console.log('Available coupons:', coupons);

            let tableRows = coupons.map(coupon => `
                <tr>
                    <td>${coupon.couponCode} 
                        <span class="copy-btn" onclick="copyToClipboard('${coupon.couponCode}')">
                            <img src="https://img.icons8.com/ios-filled/50/000000/copy.png" alt="Copy">
                        </span>
                    </td>
                    <td>${coupon.couponName}</td>
                    <td>${coupon.couponDescription}</td>
                    <td>${coupon.percentage}%</td>
                    <td>${coupon.minAmount}</td>
                    <td>${new Date(coupon.startDate).toLocaleDateString()} - ${new Date(coupon.endDate).toLocaleDateString()}</td>
                </tr>
            `).join('');

            Swal.fire({
                title: 'Coupon Details',
                html: `
                    <table border="1" cellpadding="10">
                        <thead>
                            <tr>
                                <th>Coupon Code</th>
                                <th>Coupon Name</th>
                                <th>Description</th>
                                <th>Discount Percentage</th>
                                <th>Minimum Amount</th>
                                <th>Validity</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                `,
                confirmButtonText: 'Close'
            });
        } catch (error) {
            console.error('Error fetching coupons:', error);
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Something went wrong while fetching the coupons.',
            });
        }
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text)
            .then(() => {
                Swal.fire({
                    icon: 'success',
                    title: 'Copied!',
                    text: `Coupon code "${text}" has been copied to clipboard.`,
                    timer: 1500,
                    showConfirmButton: false
                });
            })
            .catch(err => {
                console.error('Failed to copy: ', err);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to copy coupon code.',
                });
            });
    }

    function placeorder() {
        let checkedRadio = document.querySelector('input[name="addressSelected"]:checked');
        if (checkedRadio) {
            let addressId = checkedRadio.value;
    
            let method = document.getElementById('paymentMethod').value;
            console.log(method, 'method');
            console.log(addressId, 'addressId');
    
            let payment = document.getElementById("payment");
            payment.value = method;
    
            const totalprice = document.getElementById('totalprice').value;
            const couponDiscountElement = document.getElementById('couponDiscount');
            const couponDiscount = couponDiscountElement ? couponDiscountElement.innerText.replace('₹', '') : '0';
            const couponDiscountInput = document.getElementById('couponDiscountInput');
            couponDiscountInput.value = parseFloat(couponDiscount).toFixed(2); // Ensure it's a number
    
            const form = document.getElementById("myForm");
            if (method === "COD") {
                form.submit();
            } else {
                fetch('/razors', {
                    method: 'POST',
                    headers: { 'Content-type': 'application/json' },
                    body: JSON.stringify({ amount: totalprice })
                })
                .then(res => {
                    console.log('Fetch response status:', res.status);
                    return res.json();
                })
                .then(data => {
                    console.log('Data received from server:', data);
                    if (data.success) {
                        let options = {
                            "key": data.key_id,
                            "amount": data.amount,
                            "currency": "INR",
                            "name": "TORO",
                            "order_id": data.order_id,
                            "handler": function (response) {
                                form.submit();
                            },
                            "prefill": {
                                "name": data.name,
                                "email": data.email
                            }
                        };
    
                        let razorpayObject = new Razorpay(options);
                        razorpayObject.on('payment.failed', (response) => {
                            alert('Payment failed');
                        });
                        razorpayObject.open();
                    } else {
                        alert('Failed to initiate payment');
                    }
                })
                .catch(error => {
                    console.error('Error initiating payment:', error);
                    alert('Error initiating payment');
                });
            }
        } else {
            alert('Please select an address.');
        }
    }

    // Call calculateTotal initially (on page load, for example)
    calculateTotal();
</script>



</script>




    <!-- Modernizer JS -->
    <script src="user/assets/js/vendor/modernizr-3.11.7.min.js"></script>
    <!-- jquery -->
    <script src="user/assets/js/vendor/jquery-v3.6.0.min.js"></script>
    <!-- Popper JS -->
    <script src="user/assets/js/vendor/popper.js"></script>
    <!-- Bootstrap JS -->
    <script src="user/assets/js/vendor/bootstrap.min.js"></script>
    <script src="user/assets/js/plugins/owl-carousel.js"></script>
    <script src="user/assets/js/plugins/slick.js"></script>
    <script src="user/assets/js/plugins/jarallax.min.js"></script>
    <script src="user/assets/js/plugins/countdown.js"></script>
    <script src="user/assets/js/plugins/magnific-popup.js"></script>
    <script src="user/assets/js/plugins/instafeed.js"></script>
    <script src="user/assets/js/plugins/tilt.js"></script>
    <script src="user/assets/js/plugins/images-loaded.js"></script>
    <script src="user/assets/js/plugins/isotope.js"></script>
    <script src="user/assets/js/plugins/scrolloverflow-fullpage.js"></script>
    <script src="user/assets/js/plugins/fullpage.js"></script>
    <script src="user/assets/js/plugins/jquery-ui.js"></script>
    <script src="user/assets/js/plugins/jquery-ui-touch-punch.js"></script>
    <script src="user/assets/js/plugins/easyzoom.js"></script>
    <script src="user/assets/js/plugins/resizesensor.js"></script>
    <script src="user/assets/js/plugins/sticky-sidebar.js"></script>
    <script src="user/assets/js/plugins/scrollup.js"></script>
    <script src="user/assets/js/plugins/select2.min.js"></script>
    <script src="user/assets/js/plugins/cookie.js"></script>
    <script src="user/assets/js/plugins/bpopup.js"></script>
    <script src="user/assets/js/plugins/wow.js"></script>
    <script src="user/assets/js/plugins/ajax-mail.js"></script>
    <!-- Main JS -->
    <script src="user/assets/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>


<!-- Mirrored from htmldemo.net/toro/toro/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 22 Feb 2024 11:04:56 GMT -->
</html>